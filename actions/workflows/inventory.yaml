version: '2.0'

arista.inventory:
  type: direct
  input:
    - hosts

  tasks:
    facts:
      action: napalm.get_facts
      with-items: "hostname in {{ _.hosts }}"
      input:
        hostname: "{{ _.hostname }}"
      publish:
        facts: "{{ task('facts').result | map(attribute='result.raw') | list }}"
      on-success:
        - filter_facts

    filter_facts:
      action: arista.filter_facts
      input:
        facts: "{{ _.facts }}"
      publish:
        facts_filtered: "{{ task('filter_facts').result }}"

  output:
    facts: "{{ _.facts_filtered }}"
